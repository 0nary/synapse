@using ServerlessWorkflow.Sdk
@using ServerlessWorkflow.Sdk.Models
@inject WorkflowGraphBuilder WorkflowGraphBuilder 

@namespace Synapse.Dashboard

@if (graph != null) {
    <DagreGraph @ref="dagre" Graph="graph" />
}

@code {

    [Parameter]
    public WorkflowDefinition WorkflowDefinition { get; set; } = null!;

    protected IGraphViewModel? graph { get; set; }
    protected DagreGraph? dagre { get; set;  }

    protected override async Task OnParametersSetAsync()
    {
        await base.OnParametersSetAsync();
        if (this.WorkflowDefinition != null) {
            this.graph = await this.WorkflowGraphBuilder.BuildGraph(this.WorkflowDefinition);
        }
    }

    public virtual void DisplayActivityStatusFor(IEnumerable<V1WorkflowInstance> instances)
    {
        if (this.graph != null) {
            this.graph.DisplayActivityStatusFor(instances);
        }
    }

}
